<!DOCTYPE html>
<html lang="si">
<head>
    <meta charset="UTF-8">
    <title>Live Results - Best Costume</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        body {
            font-family: 'Segoe UI', sans-serif;
            background-color: #000;
            color: #fff;
            padding: 40px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        h1 { font-size: 3rem; margin-bottom: 40px; text-transform: uppercase; letter-spacing: 2px; color: #f1c40f; }
        
        .results-container {
            width: 100%;
            max-width: 900px;
        }

        .result-row {
            display: flex;
            align-items: center;
            margin-bottom: 25px;
            background: #111;
            padding: 10px;
            border-radius: 10px;
            border: 1px solid #333;
        }

        .costume-name {
            width: 200px;
            font-size: 1.5rem;
            font-weight: bold;
            padding-right: 20px;
            text-align: right;
        }

        .bar-area {
            flex-grow: 1;
            background: #333;
            height: 40px;
            border-radius: 20px;
            overflow: hidden;
            position: relative;
        }

        .bar-fill {
            height: 100%;
            background: linear-gradient(90deg, #ff4081, #ff80ab);
            width: 0%;
            transition: width 0.8s ease-out; /* Smooth Animation */
            border-radius: 20px;
        }

        .vote-count {
            width: 80px;
            text-align: left;
            padding-left: 20px;
            font-size: 1.8rem;
            font-weight: bold;
            color: #00e676;
        }
    </style>
</head>
<body>

    <h1>Live Results ðŸ“Š</h1>
    <div id="results" class="results-container">loading...</div>

    <script>
        // Supabase Config
        const supabaseUrl = 'https://vegemuqhinyxeojfbdxd.supabase.co';
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZlZ2VtdXFoaW55eGVvamZiZHhkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzEyMDkyNjIsImV4cCI6MjA4Njc4NTI2Mn0.xj1o2HaGqBBL-YpBLmHHBeUNOtNl20swXQBRp1RgdDk';
        const supabase = supabase.createClient(supabaseUrl, supabaseKey);

        async function init() {
            // 1. à¶¸à·”à¶½à·’à¶±à·Šà¶¸ à¶­à·’à¶ºà·™à¶± à¶¯à¶­à·Šà¶­ à¶§à·’à¶š à¶…à¶»à¶±à·Š à¶´à·™à¶±à·Šà¶±à¶±à·€à·
            const { data } = await supabase.from('costumes').select('*').order('id');
            renderBars(data);

            // 2. Real-time Channel à¶‘à¶šà¶§ Subscribe à¶šà¶»à¶±à·€à·
            supabase.channel('public:costumes')
            .on('postgres_changes', { event: 'UPDATE', schema: 'public', table: 'costumes' }, payload => {
                // à¶ºà¶¸à·Š à·€à·™à¶±à·ƒà¶šà·Š à·€à·”à¶«à·à¶¸ à¶¸à·šà¶š à·€à·à¶© à¶šà¶»à¶±à·€à·
                updateSingleBar(payload.new);
            })
            .subscribe();
        }

        function renderBars(data) {
            const container = document.getElementById('results');
            container.innerHTML = '';
            
            data.forEach(item => {
                container.innerHTML += `
                    <div class="result-row" id="row-${item.id}">
                        <div class="costume-name">${item.name}</div>
                        <div class="bar-area">
                            <div class="bar-fill" id="bar-${item.id}" style="width: ${calculateWidth(item.votes)}%"></div>
                        </div>
                        <div class="vote-count" id="count-${item.id}">${item.votes}</div>
                    </div>
                `;
            });
        }

        function updateSingleBar(newItem) {
            // à¶…à¶½à·”à¶­à·Š à¶…à¶œà¶ºà¶±à·Š update à¶šà·’à¶»à·“à¶¸
            const countEl = document.getElementById(`count-${newItem.id}`);
            const barEl = document.getElementById(`bar-${newItem.id}`);
            
            if (countEl) countEl.innerText = newItem.votes;
            if (barEl) barEl.style.width = calculateWidth(newItem.votes) + '%';
        }

        function calculateWidth(votes) {
            // 1000 à¶¯à·™à¶±à·™à¶šà·Š à¶‰à¶±à·Šà¶± à¶±à·’à·ƒà· 1000à¶±à·Š à¶¶à·™à¶¯à¶½à· à¶´à·Šâ€à¶»à¶­à·’à·à¶­à¶º à¶œà¶±à·Šà¶±à·€à·.
            // Bar à¶‘à¶š à¶½à·ƒà·Šà·ƒà¶±à¶§ à¶´à·šà¶±à·Šà¶± à¶•à¶± à¶±à·’à·ƒà· à¶´à·œà¶©à·’ à¶œà·à¶±à¶šà·Š à·€à·à¶©à·’ à¶šà¶»à¶½à· à¶´à·™à¶±à·Šà¶±à¶±à·€à·.
            // (votes / max_audience) * 100
            let percentage = (votes / 500) * 100; // à¶¯à·à¶±à¶§ 500à¶šà·Š à¶šà·’à¶ºà¶½ à·„à·’à¶­à¶¸à·” bar à¶‘à¶š à¶´à·’à¶»à·™à¶±à·Šà¶±
            if(percentage > 100) percentage = 100;
            return percentage;
        }

        init();
    </script>
</body>
</html>
